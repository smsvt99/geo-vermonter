<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Geo-Vermonter</title>
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" /> -->
    <script src="https://unpkg.com/@mapbox/leaflet-pip@latest/leaflet-pip.js"></script>
    <script src="border.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
        crossorigin=""></script>
</head>
<style>
    #map {
        height: 500px;
        width: 600px;
        float: left;
        z-index: 0;
    }

    #countyDropdown {
        display: none;
    }

    #alert {
        display: none;
        background-color: white;
        position: relative;
        top: 200px;
        right: 400px;
        z-index: 1;

    }

    #score {
        text-align: center;
    }
    #infoWrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 250px;
    }
</style>

<body>
    <nav id="nav"></nav>
    <button id="north" onclick="north()">North</button>
    <button id="west" onclick="west()">West</button>
    <button id="east" onclick="east()">East</button>
    <button id="south" onclick="south()">South</button>
    <button id="zoomOut" onclick="zoomOut()">Zoom Out</button>
    <div id="mapWrapper">
        <div id="map"></div>
    </div>
    <div id="alert"></div>
    <div id="infoWrapper">
        <div id="latitude">Latitude: ?</div>
        <div id="longitude">Longitude: ?</div>
        <div id="county">Country: ?</div>
        <div id="score">Score: ?</div>
    </div>
    <button id="start" onclick="startGame()">Start a Game</button>
    <button id="guess" onclick="guess()">Guess the Spot</button>
    <button id="quit" onclick="quit()">I Give Up!</button>
</body>
<script>

    let countyDropdown = document.getElementById("countyDropdown")
    console.log(countyDropdown)

    let randomLat;
    let randomLong;
    let randomPair;
    let randomPairArray = [43.7886, -72.7317]
    let zoomLevel = 7;
    let realCounty;
    let layer;
    let results;
    let wrongGuessAlert;
    let score;
    let newLat;
    let newLong
    let scoreDiv = document.getElementById("score")

    document.getElementById("guess").disabled = true;
    document.getElementById("quit").disabled = true;
    document.getElementById("zoomOut").disabled = true;
    document.getElementById("north").disabled = true;
    document.getElementById("south").disabled = true;
    document.getElementById("east").disabled = true;
    document.getElementById("west").disabled = true;

    let map = L.map('map', { zoomControl: false }).setView(randomPairArray, zoomLevel);
    mapLink =
        '<a href="http://www.esri.com/">Esri</a>';
    wholink =
        'i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community';
    L.tileLayer(
        'http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: '&copy; ' + mapLink + ', ' + wholink,
            maxZoom: zoomLevel,
            minZoom: zoomLevel,
        }).addTo(map);
    map.dragging.disable();

    function zoomOut() {
        zoomLevel--;
        score--;
        scoreDiv = document.getElementById("score")
        scoreDiv.remove()
        document.getElementById("infoWrapper").innerHTML += "<div id='score'>Score: " + score + "</div>";

        document.getElementById("mapWrapper").innerHTML = "<div id='map'></div>"
        let map = L.map('map', { zoomControl: false }).setView([newLat, newLong], zoomLevel);
        mapLink =
            '<a href="http://www.esri.com/">Esri</a>';
        wholink =
            'i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community';
        L.tileLayer(
            'http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '&copy; ' + mapLink + ', ' + wholink,
                maxZoom: zoomLevel,
                minZoom: zoomLevel,
            }).addTo(map);

        function addMapMarker(mapLat, mapLon) {
            markerID = L.marker([mapLat, mapLon]).addTo(map);
        }
        addMapMarker(randomLat, randomLong)
    }

    function randomCoords() {

        randomLat = Math.random() * (2.267) + 42.7395;
        randomLong = Math.random() * (-1.8165) - 71.5489;
        newLat = randomLat;
        newLong = randomLong;
        randomPair = randomLat + "," + randomLong
        randomPairArray = [randomLat, randomLong]

        layer = L.geoJson(border_data);
        results = leafletPip.pointInLayer([randomLong, randomLat], layer);

        if (!results.length) {
            console.log("getting new number")
            randomCoords();
        }
        else { console.log("point in polygon") }
        // if randomPair 
    }

    function startGame() {
        document.getElementById("north").disabled = false;
        document.getElementById("south").disabled = false;
        document.getElementById("east").disabled = false;
        document.getElementById("west").disabled = false;
        document.getElementById("zoomOut").disabled = false;
        zoomLevel = 18;
        score = 20;
        randomCoords();
        document.getElementById("mapWrapper").innerHTML = "<div id='map'></div>"

        let map = L.map('map', { zoomControl: false }).setView(randomPairArray, zoomLevel);
        mapLink =
            '<a href="http://www.esri.com/">Esri</a>';
        wholink =
            'i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community';
        L.tileLayer(
            'http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '&copy; ' + mapLink + ', ' + wholink,
                maxZoom: zoomLevel,
                minZoom: 17,
            }).addTo(map);
        // map.dragging.disable();

        function addMapMarker(mapLat, mapLon) {
            markerID = L.marker([mapLat, mapLon]).addTo(map);
        }

        addMapMarker(randomLat, randomLong)

        document.getElementById("start").disabled = true;
        document.getElementById("guess").disabled = false;
        document.getElementById("quit").disabled = false;

        document.getElementById("longitude").textContent = "Longitude: ?"
        document.getElementById("county").innerHTML = "<p>County: ?</p><div id='countyDropdown'></div>"
        document.getElementById("latitude").textContent = "Latitude: ?"
        scoreDiv = document.getElementById("score")
        scoreDiv.remove()
        document.getElementById("infoWrapper").innerHTML += "<div id='score'>Score: " + score + "</div>";
        closeAlert()
    }
    function guess() {
        //  let countyDropdown = document.getElementById("countyDropdown");
        countyDropdown = document.getElementById("countyDropdown")
        countyDropdown.style = "display: flex; flex-direction: column;"
        addDropdown()
    }
    function quit() {
        document.getElementById("longitude").textContent = "Longitude: " + randomLong;
        document.getElementById("county").textContent = "?"
        document.getElementById("latitude").textContent = "Latitude: " + randomLat;

        document.getElementById("guess").disabled = true;
        document.getElementById("quit").disabled = true;
    }
    let coords = border_data.geometry.coordinates[0]

    let fixedCoords = coords.map((elem) => {

        let newArray = [elem[1], elem[0]]

        return newArray
    })

    let polygon = L.polygon([
        fixedCoords
    ], { color: 'red' }).addTo(map);

    function fillCounty(county) {
        document.getElementById("countyInput").value = county.toString();
    }

    function countyGuess() {
        string = "https://nominatim.openstreetmap.org/search.php?q=" + randomPair + "&format=json"
        console.log(string)
        fetch("https://nominatim.openstreetmap.org/search.php?q=" + randomPair + "&format=json")
            .then(function (response) {

                return response.json();
            })
            .then(function (myJSON) {
                console.log({ myJSON })
                realCounty = myJSON[0].display_name

                if (realCounty.includes(document.getElementById("countyInput").value)) {
                    document.getElementById("county").innerHTML = "County: " + document.getElementById("countyInput").value + "<div id='countyDropdown'></div>"
                    rightGuessAlert = document.getElementById("alert")
                    rightGuessAlert.style = "display: inline-block;"
                    rightGuessAlert.innerHTML = "Correct! You win! <br> You scored " + score + " points!<br><button onclick='closeAlert()' id='guessAgain'>Close</button>"
                    document.getElementById("latitude").textContent = "Latitude: " + randomLat;
                    document.getElementById("longitude").textContent = "Longitude: " + randomLong;
                    document.getElementById("start").disabled = false;
                    document.getElementById("guess").disabled = true;
                    document.getElementById("quit").disabled = true;

                }
                else {
                    score--
                    scoreDiv = document.getElementById("score")
                    scoreDiv.remove()
                    document.getElementById("infoWrapper").innerHTML += "<div id='score'>Score: " + score + "</div>";
                    wrongGuessAlert = document.getElementById("alert")
                    wrongGuessAlert.style = "display: inline-block;"
                    wrongGuessAlert.innerHTML = "Wrong guess, guess again! <button onclick='closeAlert()' id='guessAgain'>Guess Again</button>"
                    console.log("wrong guess")
                }

            })
    }
    function closeAlert() {
        wrongGuessAlert = document.getElementById("alert")
        wrongGuessAlert.style = "display: none;"
    }

    function addDropdown() {
        countyDropdown = document.getElementById("countyDropdown")
        countyArray = ["Addison County", "Bennington County", "Caledonia County", "Chittenden County", "Essex County", "Franklin County", "Grand Isle County", "Lamoille County", "Orange County", "Orleans County", "Rutland County", "Washington County", "Windham County", "Windsor County"]
        countyDropdown.innerHTML += "<p>What County are we in?</p>"
        for (i = 0; i < countyArray.length; i++) {

            countyDropdown.innerHTML += `<a href='#countyInput' onclick='fillCounty("${countyArray[i]}")'><div id='${countyArray[i]}'>${countyArray[i]}</div></a>`

        }
        countyDropdown.innerHTML += "<input id='countyInput' type='text'>"
        countyDropdown.innerHTML += "<button onclick='countyGuess()'>Guess</button>"
        countyDropdown.innerHTML += "<button>Cancel</button>"
    }
    function north() {
        document.getElementById("mapWrapper").innerHTML = "<div id='map'></div>"

        newLat = newLat + .001;

        let map = L.map('map', { zoomControl: false }).setView([newLat, newLong], zoomLevel);
        mapLink =
            '<a href="http://www.esri.com/">Esri</a>';
        wholink =
            'i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community';
        L.tileLayer(
            'http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '&copy; ' + mapLink + ', ' + wholink,
                maxZoom: zoomLevel,
                minZoom: 1,
            }).addTo(map);

        function addMapMarker(mapLat, mapLon) {
            markerID = L.marker([mapLat, mapLon]).addTo(map);
        }
        addMapMarker(randomLat, randomLong)
        score--
        scoreDiv = document.getElementById("score")
        scoreDiv.remove()
        document.getElementById("infoWrapper").innerHTML += "<div id='score'>Score: " + score + "</div>";
    }
    function south() {
        document.getElementById("mapWrapper").innerHTML = "<div id='map'></div>"

        newLat = newLat - .001;

        let map = L.map('map', { zoomControl: false }).setView([newLat, newLong], zoomLevel);
        mapLink =
            '<a href="http://www.esri.com/">Esri</a>';
        wholink =
            'i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community';
        L.tileLayer(
            'http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '&copy; ' + mapLink + ', ' + wholink,
                maxZoom: zoomLevel,
                minZoom: 1,
            }).addTo(map);
        map.dragging.disable();

        function addMapMarker(mapLat, mapLon) {
            markerID = L.marker([mapLat, mapLon]).addTo(map);
        }
        addMapMarker(randomLat, randomLong)
        score--
        scoreDiv = document.getElementById("score")
        scoreDiv.remove()
        document.getElementById("infoWrapper").innerHTML += "<div id='score'>Score: " + score + "</div>";
    }
    function east() {
        document.getElementById("mapWrapper").innerHTML = "<div id='map'></div>"

        newLong = newLong + .002;

        let map = L.map('map', { zoomControl: false }).setView([newLat, newLong], zoomLevel);
        mapLink =
            '<a href="http://www.esri.com/">Esri</a>';
        wholink =
            'i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community';
        L.tileLayer(
            'http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '&copy; ' + mapLink + ', ' + wholink,
                maxZoom: zoomLevel,
                minZoom: 1,
            }).addTo(map);
        map.dragging.disable();

        function addMapMarker(mapLat, mapLon) {
            markerID = L.marker([mapLat, mapLon]).addTo(map);
        }
        addMapMarker(randomLat, randomLong)
        score--
        scoreDiv = document.getElementById("score")
        scoreDiv.remove()
        document.getElementById("infoWrapper").innerHTML += "<div id='score'>Score: " + score + "</div>";
    }
    function west() {
        document.getElementById("mapWrapper").innerHTML = "<div id='map'></div>"

        newLong = newLong - .002;

        let map = L.map('map', { zoomControl: false }).setView([newLat, newLong], zoomLevel);
        mapLink =
            '<a href="http://www.esri.com/">Esri</a>';
        wholink =
            'i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community';
        L.tileLayer(
            'http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '&copy; ' + mapLink + ', ' + wholink,
                maxZoom: zoomLevel,
                minZoom: 1,
            }).addTo(map);
        map.dragging.disable();

        function addMapMarker(mapLat, mapLon) {
            markerID = L.marker([mapLat, mapLon]).addTo(map);
        }
        addMapMarker(randomLat, randomLong)
        score--
        scoreDiv = document.getElementById("score")
        scoreDiv.remove()
        document.getElementById("infoWrapper").innerHTML += "<div id='score'>Score: " + score + "</div>";
    }
</script>

</html>